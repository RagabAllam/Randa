<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>قائمة الأكلات المصرية</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap');

        :root {
            --primary-color: #FF5722;
            --primary-dark: #E64A19;
            --secondary-color: #2196F3;
            --secondary-dark: #1976D2;
            --success-color: #4CAF50;
            --success-dark: #388E3C;
            --danger-color: #F44336;
            --danger-dark: #D32F2F;
            --gray-light: #f5f5f5;
            --gray-medium: #e0e0e0;
            --text-color: #333;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Cairo', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            direction: rtl;
            color: var(--text-color);
        }

        .container {
            max-width: 100%;
            padding: 20px;
            margin: 0 auto;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        @media (min-width: 768px) {
            .container {
                max-width: 1000px;
                margin: 20px auto;
                padding: 30px;
            }
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        header::after {
            content: "";
            display: block;
            width: 100px;
            height: 4px;
            background: var(--primary-color);
            margin: 10px auto 0;
            border-radius: 2px;
        }

        h1 {
            color: var(--primary-color);
            font-size: 2rem;
            margin: 0;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.1);
        }

        @media (min-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
        }

        .subtitle {
            color: #888;
            font-size: 1.1rem;
            margin-top: 5px;
        }

        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 20px;
            overflow: hidden;
            transition: var(--transition);
        }

        .card-header {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 15px;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .card-body {
            padding: 15px;
        }

        @media (min-width: 768px) {
            .card-header {
                padding: 15px 20px;
                font-size: 1.2rem;
            }

            .card-body {
                padding: 20px;
            }
        }

        .form-row {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        @media (min-width: 768px) {
            .form-row {
                flex-direction: row;
                gap: 15px;
                margin-bottom: 20px;
            }
        }

        .form-group {
            flex: 1;
            margin-bottom: 12px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #555;
        }

        input, select {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--gray-medium);
            border-radius: var(--border-radius);
            font-size: 16px;
            font-family: 'Cairo', sans-serif;
            transition: var(--transition);
        }

        @media (min-width: 768px) {
            input, select {
                padding: 12px 15px;
            }
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 87, 34, 0.2);
        }

        .buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 16px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-family: 'Cairo', sans-serif;
            font-size: 15px;
            font-weight: 600;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
            min-width: 120px;
        }

        @media (min-width: 768px) {
            button {
                padding: 12px 20px;
                font-size: 16px;
                flex: none;
                min-width: auto;
            }
        }

        button i {
            font-size: 16px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: var(--secondary-dark);
            transform: translateY(-2px);
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: var(--success-dark);
            transform: translateY(-2px);
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
            padding: 6px 10px;
            font-size: 14px;
            min-width: auto;
        }

        .btn-danger:hover {
            background-color: var(--danger-dark);
        }

        .btn-warning {
            background-color: #FFC107;
            color: #333;
            padding: 6px 10px;
            font-size: 14px;
            min-width: auto;
            margin-right: 5px;
        }

        .btn-warning:hover {
            background-color: #FFA000;
            color: #333;
        }

        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-bottom: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        th, td {
            border: 1px solid var(--gray-medium);
            padding: 10px;
            text-align: right;
        }

        @media (min-width: 768px) {
            th, td {
                padding: 15px;
            }
        }

        th {
            background: linear-gradient(to bottom, var(--primary-color), var(--primary-dark));
            color: white;
            font-weight: 600;
            white-space: nowrap;
        }

        tbody tr {
            transition: var(--transition);
        }

        tbody tr:nth-child(even) {
            background-color: var(--gray-light);
        }

        tbody tr:hover {
            background-color: rgba(255, 87, 34, 0.05);
        }

        .no-items {
            text-align: center;
            color: #999;
            padding: 20px;
            font-size: 1rem;
            background-color: var(--gray-light);
            border-radius: var(--border-radius);
            margin: 15px 0;
        }

        @media (min-width: 768px) {
            .no-items {
                padding: 30px;
                font-size: 1.1rem;
            }
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 25px;
        }

        @media (min-width: 768px) {
            .action-buttons {
                flex-direction: row;
                gap: 20px;
                margin-top: 40px;
            }
        }

        .action-button {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            border-radius: var(--border-radius);
            text-align: center;
        }

        @media (min-width: 768px) {
            .action-button {
                flex: 1;
                max-width: 250px;
                padding: 15px;
                font-size: 1.1rem;
            }
        }

        #pdf-section {
            background-color: white;
            padding: 20px;
            direction: rtl;
            font-family: 'Cairo', sans-serif;
        }

        .page-footer {
            margin-top: 30px;
            text-align: center;
            color: #888;
            font-size: 0.9rem;
            padding-top: 15px;
            border-top: 1px solid var(--gray-medium);
        }

        .food-count {
            position: absolute;
            top: 5px;
            left: 5px;
            background-color: var(--primary-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            font-size: 0.9rem;
        }

        @media (min-width: 768px) {
            .food-count {
                top: 10px;
                left: 10px;
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
        }

        @media print {
            body * {
                visibility: hidden;
            }
            #print-section, #print-section * {
                visibility: visible;
            }
            #print-section {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                display: block;
            }
            .no-print {
                display: none;
            }
        }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease forwards;
        }

        #pdf-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        #pdf-table th, #pdf-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: right;
        }

        #pdf-table th {
            background-color: #FF5722;
            color: white;
        }

        #pdf-content {
            display: none;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--gray-medium);
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab:hover:not(.active) {
            background-color: var(--gray-light);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease forwards;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            width: 90%;
            max-width: 500px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        @media (min-width: 768px) {
            .modal-content {
                padding: 30px;
            }
        }

        .close {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: var(--primary-color);
        }

        .modal-header {
            padding-bottom: 15px;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--gray-medium);
        }

        .modal-title {
            color: var(--primary-color);
            margin-top: 0;
            margin-bottom: 5px;
        }

        .category-tag {
            display: inline-block;
            background-color: var(--secondary-color);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>قائمة الأكلات المصرية</h1>
            <p class="subtitle">راندة انس</p>
            <div id="menu-counter" class="food-count">0</div>
        </header>

        <div class="no-print">
            <div class="tabs">
                <div class="tab active" onclick="openTab('tab-menu')">قائمتي</div>
                <div class="tab" onclick="openTab('tab-categories')">إدارة الأصناف</div>
            </div>

            <!-- قسم قائمتي -->
            <div id="tab-menu" class="tab-content active">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-plus-circle"></i> إضافة أكلة إلى القائمة
                    </div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="food-select"><i class="fas fa-list"></i> اختر الأكلة:</label>
                                <select id="food-select">
                                    <option value="">-- اختر أكلة --</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="menu-price"><i class="fas fa-money-bill-wave"></i> السعر (جنيه):</label>
                                <input type="number" id="menu-price" placeholder="أدخل السعر" min="0" step="0.01">
                            </div>
                        </div>

                        <div class="buttons">
                            <button class="btn-primary" onclick="addToMenu()">
                                <i class="fas fa-plus"></i> إضافة إلى القائمة
                            </button>
                            <button class="btn-secondary" onclick="clearMenuForm()">
                                <i class="fas fa-eraser"></i> مسح البيانات
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-list"></i> قائمة الأكلات الحالية
                    </div>
                    <div class="card-body">
                        <div id="menu-table-container">
                            <p class="no-items"><i class="fas fa-info-circle"></i> لا توجد أكلات في القائمة حالياً. برجاء إضافة أكلات.</p>
                        </div>
                    </div>
                </div>

                <div class="action-buttons no-print">
                    <button class="action-button btn-secondary" onclick="generatePDF()">
                        <i class="fas fa-file-pdf"></i> تحميل كملف PDF
                    </button>
                    <button class="action-button btn-success" onclick="printTable()">
                        <i class="fas fa-print"></i> طباعة القائمة
                    </button>
                </div>
            </div>

            <!-- قسم إدارة الأصناف -->
            <div id="tab-categories" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-plus-circle"></i> إضافة صنف جديد
                    </div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="category-name"><i class="fas fa-tag"></i> الصنف:</label>
                                <select id="category-name">
                                    <option value="">-- اختر الصنف --</option>
                                    <option value="أطباق رئيسية">أطباق رئيسية</option>
                                    <option value="مقبلات">مقبلات</option>
                                    <option value="حلويات">حلويات</option>
                                    <option value="مشروبات">مشروبات</option>
                                    <option value="أخرى">أخرى</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="food-name"><i class="fas fa-utensils"></i> اسم الأكلة:</label>
                                <input type="text" id="food-name" placeholder="أدخل اسم الأكلة المصرية">
                            </div>

                            <div class="form-group">
                                <label for="food-price"><i class="fas fa-money-bill-wave"></i> السعر (جنيه):</label>
                                <input type="number" id="food-price" placeholder="أدخل السعر" min="0" step="0.01">
                            </div>
                        </div>

                        <div class="buttons">
                            <button class="btn-primary" onclick="addFood()">
                                <i class="fas fa-plus"></i> إضافة صنف
                            </button>
                            <button class="btn-secondary" onclick="clearForm()">
                                <i class="fas fa-eraser"></i> مسح البيانات
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-database"></i> قاعدة بيانات الأصناف
                    </div>
                    <div class="card-body">
                        <div id="food-table-container">
                            <p class="no-items"><i class="fas fa-info-circle"></i> لا توجد أصناف في قاعدة البيانات. برجاء إضافة أصناف.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="print-section"></div>

        <!-- قسم محتوى PDF -->
        <div id="pdf-content">
            <h2 style="text-align: center; color: #FF5722; margin-bottom: 10px;">قائمة الأكلات المصرية</h2>
            <p style="text-align: center; margin-bottom: 5px;">راندة انس</p>
            <p style="text-align: center; margin-bottom: 15px;" id="pdf-date"></p>
            <div id="pdf-table-container"></div>
            <p style="text-align: center; margin-top: 20px; font-size: 14px; color: #888;">
                تم إنشاء هذه القائمة بواسطة راندة انس
            </p>
        </div>

        <!-- مودال تعديل الصنف -->
        <div id="editModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <span class="close" onclick="closeModal()">&times;</span>
                    <h3 class="modal-title">تعديل بيانات الصنف</h3>
                </div>
                <div class="form-group">
                    <label for="edit-category"><i class="fas fa-tag"></i> الصنف:</label>
                    <select id="edit-category">
                        <option value="أطباق رئيسية">أطباق رئيسية</option>
                        <option value="مقبلات">مقبلات</option>
                        <option value="حلويات">حلويات</option>
                        <option value="مشروبات">مشروبات</option>
                        <option value="أخرى">أخرى</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-name"><i class="fas fa-utensils"></i> اسم الأكلة:</label>
                    <input type="text" id="edit-name">
                </div>
                <div class="form-group">
                    <label for="edit-price"><i class="fas fa-money-bill-wave"></i> السعر (جنيه):</label>
                    <input type="number" id="edit-price" min="0" step="0.01">
                </div>
                <input type="hidden" id="edit-id">
                <div class="buttons">
                    <button class="btn-primary" onclick="saveEdit()">
                        <i class="fas fa-save"></i> حفظ التغييرات
                    </button>
                </div>
            </div>
        </div>

        <div class="page-footer">
            تم إنشاء هذه القائمة بتاريخ <span id="current-date"></span>
        </div>
    </div>

    <script>
        // إعداد التاريخ الحالي
        document.getElementById('current-date').textContent = new Date().toLocaleDateString('ar-EG');

        // مصفوفات لتخزين البيانات
        let foodCatalog = []; // قاعدة بيانات الأصناف
        let menuItems = []; // قائمة الطعام الحالية

        // دالة لفتح تبويب
        function openTab(tabId) {
            // إخفاء جميع المحتويات
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }

            // إزالة التنشيط من جميع التبويبات
            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }

            // تنشيط التبويب والمحتوى المطلوب
            document.getElementById(tabId).classList.add('active');
            const activeTab = document.querySelector(`.tab[onclick="openTab('${tabId}')"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }
        }

        // دالة للتحميل عند بدء التشغيل
        window.onload = function() {
            loadData();
            updateFoodDropdown();
            updateFoodTable();
            updateMenuTable();
        };

        // دالة لتحميل البيانات من التخزين المحلي
        function loadData() {
            const savedFoodCatalog = localStorage.getItem('foodCatalog');
            if (savedFoodCatalog) {
                foodCatalog = JSON.parse(savedFoodCatalog);
            }

            const savedMenuItems = localStorage.getItem('menuItems');
            if (savedMenuItems) {
                menuItems = JSON.parse(savedMenuItems);
            }

            // تحديث عداد القائمة
            updateMenuCounter();
        }

        // دالة لحفظ البيانات في التخزين المحلي
        function saveData() {
            localStorage.setItem('foodCatalog', JSON.stringify(foodCatalog));
            localStorage.setItem('menuItems', JSON.stringify(menuItems));
        }

        // دالة لإضافة صنف جديد
        function addFood() {
            const category = document.getElementById('category-name').value.trim();
            const foodName = document.getElementById('food-name').value.trim();
            const foodPrice = parseFloat(document.getElementById('food-price').value.trim());

            if (category === '') {
                alert('برجاء اختيار صنف');
                return;
            }

            if (foodName === '' || isNaN(foodPrice)) {
                alert('برجاء إدخال اسم الأكلة والسعر الصحيح');
                return;
            }

            if (foodPrice <= 0) {
                alert('برجاء إدخال سعر صحيح أكبر من صفر');
                return;
            }

            // التحقق من عدم وجود نفس الاسم
            const foodExists = foodCatalog.some(item => item.name.toLowerCase() === foodName.toLowerCase());
            if (foodExists) {
                alert('هذه الأكلة موجودة بالفعل. برجاء استخدام اسم مختلف أو تحديث السعر للأكلة الموجودة.');
                return;
            }

            // إضافة الصنف إلى المصفوفة
            foodCatalog.push({
                id: Date.now(), // استخدام الطابع الزمني كمعرف فريد
                category: category,
                name: foodName,
                price: foodPrice
            });

            // حفظ البيانات
            saveData();

            // تحديث الجدول وقائمة الأكلات
            updateFoodTable();
            updateFoodDropdown();

            // مسح النموذج
            clearForm();
        }

        // دالة لتحديث قائمة الأكلات المنسدلة
        function updateFoodDropdown() {
            const foodSelect = document.getElementById('food-select');

            // مسح القائمة الحالية
            foodSelect.innerHTML = '<option value="">-- اختر أكلة --</option>';

            // ترتيب الأصناف حسب الصنف ثم الاسم
            const sortedFoods = [...foodCatalog].sort((a, b) => {
                if (a.category !== b.category) {
                    return a.category.localeCompare(b.category);
                }
                return a.name.localeCompare(b.name);
            });

            // إضافة الأصناف المتاحة
            sortedFoods.forEach(food => {
                const option = document.createElement('option');
                option.value = food.id;
                option.textContent = `${food.name} (${food.category})`;
                option.dataset.price = food.price;
                foodSelect.appendChild(option);
            });
        }

        // دالة لتحديث جدول الأصناف
        function updateFoodTable() {
            const tableContainer = document.getElementById('food-table-container');

            if (foodCatalog.length === 0) {
                tableContainer.innerHTML = '<p class="no-items"><i class="fas fa-info-circle"></i> لا توجد أصناف في قاعدة البيانات. برجاء إضافة أصناف.</p>';
                return;
            }

            // ترتيب الأصناف حسب الصنف ثم الاسم
            const sortedFoods = [...foodCatalog].sort((a, b) => {
                if (a.category !== b.category) {
                    return a.category.localeCompare(b.category);
                }
                return a.name.localeCompare(b.name);
            });

            // إنشاء الجدول
            let tableHTML = `
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>الصنف</th>
                                <th>اسم الأكلة</th>
                                <th>السعر (جنيه)</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            sortedFoods.forEach(food => {
                tableHTML += `
                    <tr>
                        <td><span class="category-tag">${food.category}</span></td>
                        <td>${food.name}</td>
                        <td>${food.price.toFixed(2)}</td>
                        <td>
                            <button class="btn-warning" onclick="editFood(${food.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-danger" onclick="removeFood(${food.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });

            tableHTML += `
                        </tbody>
                    </table>
                </div>
            `;

            tableContainer.innerHTML = tableHTML;
        }

        // دالة لإضافة أكلة إلى القائمة
        function addToMenu() {
            const foodSelect = document.getElementById('food-select');
            const foodId = foodSelect.value;
            const menuPrice = parseFloat(document.getElementById('menu-price').value);

            if (foodId === '') {
                alert('برجاء اختيار أكلة من القائمة');
                return;
            }

            if (isNaN(menuPrice) || menuPrice <= 0) {
                alert('برجاء إدخال سعر صحيح أكبر من صفر');
                return;
            }

            // البحث عن الأكلة في قاعدة البيانات
            const selectedFood = foodCatalog.find(food => food.id == foodId);
            if (!selectedFood) {
                alert('لم يتم العثور على الأكلة المحددة');
                return;
            }

            // التحقق من عدم وجود الأكلة في القائمة بالفعل
            const foodInMenu = menuItems.some(item => item.foodId == foodId);
            if (foodInMenu) {
                alert('هذه الأكلة موجودة بالفعل في القائمة. يمكنك تحديثها بدلاً من ذلك.');
                return;
            }

            // إضافة إلى القائمة
            menuItems.push({
                id: Date.now(),
                foodId: foodId,
                name: selectedFood.name,
                category: selectedFood.category,
                price: menuPrice
            });

            // حفظ البيانات
            saveData();

            // تحديث جدول القائمة
            updateMenuTable();

            // تحديث عداد القائمة
            updateMenuCounter();

            // مسح نموذج القائمة
            clearMenuForm();
        }

        // دالة لتحديث جدول القائمة
        function updateMenuTable() {
            const tableContainer = document.getElementById('menu-table-container');

            if (menuItems.length === 0) {
                tableContainer.innerHTML = '<p class="no-items"><i class="fas fa-info-circle"></i> لا توجد أكلات في القائمة حالياً. برجاء إضافة أكلات.</p>';
                return;
            }

            // ترتيب العناصر حسب الصنف ثم الاسم
            const sortedItems = [...menuItems].sort((a, b) => {
                if (a.category !== b.category) {
                    return a.category.localeCompare(b.category);
                }
                return a.name.localeCompare(b.name);
            });

            // إنشاء الجدول
            let tableHTML = `
                <div class="table-responsive">
                    <table>
                        <thead>
                            <tr>
                                <th>الصنف</th>
                                <th>اسم الأكلة</th>
                                <th>السعر (جنيه)</th>
                                <th>الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            sortedItems.forEach(item => {
                tableHTML += `
                    <tr>
                        <td><span class="category-tag">${item.category}</span></td>
                        <td>${item.name}</td>
                        <td>${item.price.toFixed(2)}</td>
                        <td>
                            <button class="btn-warning" onclick="editMenuItem(${item.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-danger" onclick="removeMenuItem(${item.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });

            tableHTML += `
                        </tbody>
                    </table>
                </div>
            `;

            tableContainer.innerHTML = tableHTML;
        }

        // دالة لتحديث عداد القائمة
        function updateMenuCounter() {
            document.getElementById('menu-counter').textContent = menuItems.length;
        }

        // دالة لمسح نموذج الأصناف
        function clearForm() {
            document.getElementById('category-name').value = '';
            document.getElementById('food-name').value = '';
            document.getElementById('food-price').value = '';
        }

        // دالة لمسح نموذج القائمة
        function clearMenuForm() {
            document.getElementById('food-select').value = '';
            document.getElementById('menu-price').value = '';
        }

        // دالة لحذف صنف
        function removeFood(id) {
            if (!confirm('هل أنت متأكد من حذف هذا الصنف؟')) {
                return;
            }

            // حذف الصنف من قاعدة البيانات
            foodCatalog = foodCatalog.filter(food => food.id != id);

            // حذف أي استخدام لهذا الصنف في القائمة
            menuItems = menuItems.filter(item => item.foodId != id);

            // حفظ البيانات
            saveData();

            // تحديث الجداول
            updateFoodTable();
            updateFoodDropdown();
            updateMenuTable();

            // تحديث العداد
            updateMenuCounter();
        }

        // دالة لحذف عنصر من القائمة
        function removeMenuItem(id) {
            if (!confirm('هل أنت متأكد من حذف هذا العنصر من القائمة؟')) {
                return;
            }

            // حذف العنصر من القائمة
            menuItems = menuItems.filter(item => item.id != id);

            // حفظ البيانات
            saveData();

            // تحديث الجدول
            updateMenuTable();

            // تحديث العداد
            updateMenuCounter();
        }

        // دالة لتعديل صنف
        function editFood(id) {
            const food = foodCatalog.find(item => item.id == id);
            if (!food) {
                return;
            }

            // ملء نموذج التعديل
            document.getElementById('edit-category').value = food.category;
            document.getElementById('edit-name').value = food.name;
            document.getElementById('edit-price').value = food.price;
            document.getElementById('edit-id').value = food.id;

            // عرض المودال
            document.getElementById('editModal').style.display = 'block';
        }

        // دالة لحفظ التعديلات
        function saveEdit() {
            const id = document.getElementById('edit-id').value;
            const category = document.getElementById('edit-category').value.trim();
            const name = document.getElementById('edit-name').value.trim();
            const price = parseFloat(document.getElementById('edit-price').value);

            if (category === '' || name === '' || isNaN(price) || price <= 0) {
                alert('برجاء إدخال جميع البيانات بشكل صحيح');
                return;
            }

            // التحقق من عدم وجود نفس الاسم (مع استثناء الصنف نفسه)
            const nameExists = foodCatalog.some(item =>
                item.id != id && item.name.toLowerCase() === name.toLowerCase());

            if (nameExists) {
                alert('هذا الاسم موجود بالفعل. برجاء استخدام اسم مختلف.');
                return;
            }

            // تحديث الصنف
            const foodIndex = foodCatalog.findIndex(item => item.id == id);
            if (foodIndex !== -1) {
                const oldFood = foodCatalog[foodIndex];

                // تحديث الصنف
                foodCatalog[foodIndex] = {
                    ...oldFood,
                    category: category,
                    name: name,
                    price: price
                };

                // تحديث أي استخدامات في القائمة (فقط الاسم والصنف)
                menuItems.forEach(item => {
                    if (item.foodId == id) {
                        item.name = name;
                        item.category = category;
                    }
                });

                // حفظ البيانات
                saveData();

                // تحديث الجداول
                updateFoodTable();
                updateFoodDropdown();
                updateMenuTable();

                // إغلاق المودال
                closeModal();
            }
        }

        // دالة لتعديل عنصر في القائمة
        function editMenuItem(id) {
            const menuItem = menuItems.find(item => item.id == id);
            if (!menuItem) {
                return;
            }

            // استخدام نافذة الإدخال للحصول على السعر الجديد
            const newPrice = prompt(`أدخل السعر الجديد للأكلة "${menuItem.name}":`, menuItem.price);

            // التحقق من صحة السعر
            if (newPrice === null) {
                return; // تم الإلغاء
            }

            const parsedPrice = parseFloat(newPrice);
            if (isNaN(parsedPrice) || parsedPrice <= 0) {
                alert('برجاء إدخال سعر صحيح أكبر من صفر');
                return;
            }

            // تحديث السعر
            menuItem.price = parsedPrice;

            // حفظ البيانات
            saveData();

            // تحديث جدول القائمة
            updateMenuTable();
        }

        // دالة لإغلاق المودال
        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        // إغلاق المودال عند النقر خارجه
        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target == modal) {
                closeModal();
            }
        }

        // دالة لطباعة القائمة
        function printTable() {
            if (menuItems.length === 0) {
                alert('لا توجد أكلات في القائمة للطباعة');
                return;
            }

            // ترتيب العناصر حسب الصنف ثم الاسم
            const sortedItems = [...menuItems].sort((a, b) => {
                if (a.category !== b.category) {
                    return a.category.localeCompare(b.category);
                }
                return a.name.localeCompare(b.name);
            });

            // إنشاء جدول القائمة للطباعة
            let printContent = `
                <div style="direction: rtl; font-family: 'Cairo', sans-serif; padding: 20px;">
                    <h2 style="text-align: center; color: #FF5722; margin-bottom: 10px;">قائمة الأكلات المصرية</h2>
                    <p style="text-align: center; margin-bottom: 15px;">راندة انس - ${new Date().toLocaleDateString('ar-EG')}</p>

                    <div style="overflow-x: auto;">
                        <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                            <thead>
                                <tr>
                                    <th style="border: 1px solid #ddd; padding: 10px; background-color: #FF5722; color: white;">الصنف</th>
                                    <th style="border: 1px solid #ddd; padding: 10px; background-color: #FF5722; color: white;">اسم الأكلة</th>
                                    <th style="border: 1px solid #ddd; padding: 10px; background-color: #FF5722; color: white;">السعر (جنيه)</th>
                                </tr>
                            </thead>
                            <tbody>
            `;

            // تنظيم العناصر حسب الصنف
            const categorizedItems = {};

            sortedItems.forEach(item => {
                if (!categorizedItems[item.category]) {
                    categorizedItems[item.category] = [];
                }
                categorizedItems[item.category].push(item);
            });

            // إضافة العناصر حسب الصنف
            Object.keys(categorizedItems).sort().forEach(category => {
                // إضافة صف العنوان للصنف
                printContent += `
                    <tr>
                        <td colspan="3" style="border: 1px solid #ddd; padding: 10px; background-color: #f5f5f5; font-weight: bold; text-align: right;">
                            ${category}
                        </td>
                    </tr>
                `;

                // إضافة العناصر
                categorizedItems[category].forEach(item => {
                    printContent += `
                        <tr>
                            <td style="border: 1px solid #ddd; padding: 10px;"></td>
                            <td style="border: 1px solid #ddd; padding: 10px;">${item.name}</td>
                            <td style="border: 1px solid #ddd; padding: 10px;">${item.price.toFixed(2)}</td>
                        </tr>
                    `;
                });
            });

            printContent += `
                            </tbody>
                        </table>
                    </div>

                    <p style="text-align: center; margin-top: 20px; font-size: 14px; color: #888;">
                        تم إنشاء هذه القائمة بواسطة راندة انس
                    </p>
                </div>
            `;

            // إضافة المحتوى إلى قسم الطباعة
            const printSection = document.getElementById('print-section');
            printSection.innerHTML = printContent;

            // طباعة
            window.print();
        }

        // دالة لإنشاء ملف PDF
        function generatePDF() {
            if (menuItems.length === 0) {
                alert('لا توجد أكلات في القائمة لإنشاء ملف PDF');
                return;
            }

            // تعيين التاريخ
            document.getElementById('pdf-date').textContent = new Date().toLocaleDateString('ar-EG');

            // ترتيب العناصر حسب الصنف ثم الاسم
            const sortedItems = [...menuItems].sort((a, b) => {
                if (a.category !== b.category) {
                    return a.category.localeCompare(b.category);
                }
                return a.name.localeCompare(b.name);
            });

            // إنشاء جدول PDF
            let pdfTable = `
                <table id="pdf-table">
                    <thead>
                        <tr>
                            <th>الصنف</th>
                            <th>اسم الأكلة</th>
                            <th>السعر (جنيه)</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            // تنظيم العناصر حسب الصنف
            const categorizedItems = {};

            sortedItems.forEach(item => {
                if (!categorizedItems[item.category]) {
                    categorizedItems[item.category] = [];
                }
                categorizedItems[item.category].push(item);
            });

            // إضافة العناصر حسب الصنف
            Object.keys(categorizedItems).sort().forEach(category => {
                // إضافة صف العنوان للصنف
                pdfTable += `
                    <tr>
                        <td colspan="3" style="background-color: #f5f5f5; font-weight: bold; text-align: right;">
                            ${category}
                        </td>
                    </tr>
                `;

                // إضافة العناصر
                categorizedItems[category].forEach(item => {
                    pdfTable += `
                        <tr>
                            <td></td>
                            <td>${item.name}</td>
                            <td>${item.price.toFixed(2)}</td>
                        </tr>
                    `;
                });
            });

            pdfTable += `
                </tbody>
            </table>
            `;

            // إضافة الجدول إلى محتوى PDF
            document.getElementById('pdf-table-container').innerHTML = pdfTable;

            // تهيئة jsPDF وإنشاء الملف
            const { jsPDF } = window.jspdf;

            // استخدام HTML2Canvas لتحويل محتوى PDF إلى صورة
            const pdfContent = document.getElementById('pdf-content');
            pdfContent.style.display = 'block';

            html2canvas(pdfContent, {
                scale: 2,
                useCORS: true,
                logging: false
            }).then(canvas => {
                // إخفاء محتوى PDF بعد التحويل
                pdfContent.style.display = 'none';

                // إنشاء PDF بالتوجيه الصحيح
                const pdf = new jsPDF('p', 'mm', 'a4');

                // أبعاد A4 بالملليمتر
                const pageWidth = 210;
                const pageHeight = 297;

                // تحويل Canvas إلى صورة
                const imgData = canvas.toDataURL('image/png');

                // نسبة العرض إلى الارتفاع للحفاظ على النسب
                const imgWidth = pageWidth - 20; // هوامش
                const imgHeight = (canvas.height * imgWidth) / canvas.width;

                // إضافة الصورة إلى PDF
                pdf.addImage(imgData, 'PNG', 10, 10, imgWidth, imgHeight);

                // حفظ الملف
                pdf.save('قائمة_الأكلات_المصرية.pdf');
            });
        }
    </script>
</body>
</html>
